{{ header }}{{ navigation }}
<main style="margin-top: 58px" class="pt-4">
<div class="container-fluid">
  <div class="text-end">
	<a href="{{ authorize }}" class="btn btn-link" data-mdb-ripple-color="dark"><i class="fas fa-user-circle me-2"></i>{{ text_authorize }}</a>
	<span class="btn btn-link text-dark" data-mdb-ripple-color="dark"><i class="fas fa-tools me-2"></i>{{ text_setting }}</span>
	<a href="{{ home }}" class="btn btn-link" data-mdb-ripple-color="dark"><i class="fas fa-home me-2"></i>{{ text_home }}</a>
  </div>
  {% if error_warning %}
	<div class="alert alert-dismissible fade show" role="alert" data-mdb-color="danger"><i class="fa fa-exclamation-circle me-2"></i>{{ error_warning }}<button type="button" class="btn-close" data-mdb-dismiss="alert" aria-label="Close"></button></div>
  {% endif %}
  {% if success %}
	<div class="alert alert-dismissible fade show" role="alert" data-mdb-color="success"><i class="fa fa-exclamation-circle me-2"></i>{{ success }}<button type="button" class="btn-close" data-mdb-dismiss="alert" aria-label="Close"></button> </div>
  {% endif %}
  <form method="POST" action="{{ action }}">
	<div class="mt-3">
	  <select name="fulfillment_policy_id" class="select">
		<option value="" selected disabled>{{ text_select }}</option>
		{% for fulfillment_policy in fulfillment_policies %}
		<option value="{{ fulfillment_policy.fulfillmentPolicyId }}" {% if fulfillment_policy.fulfillmentPolicyId == fulfillment_policy_id %}selected{% endif %}>{{ fulfillment_policy.name }}</option>
		{% endfor %}
	  </select>
	  <label class="form-label select-label">{{ select_fulfillment_policy }}</label>
	</div>
	<div class="mt-3">
	  <select name="payment_policy_id" class="select">
		<option value="" selected disabled>{{ text_select }}</option>
		{% for payment_policy in payment_policies %}
		<option value="{{ payment_policy.paymentPolicyId }}" {% if payment_policy.paymentPolicyId == payment_policy_id %}selected{% endif %}>{{ payment_policy.name }}</option>
		{% endfor %}
	  </select>
	  <label class="form-label select-label">{{ select_payment_policy }}</label>
	</div>
	<div class="mt-3">
	  <select name="return_policy_id" class="select">
		<option value="" selected disabled>{{ text_select }}</option>
		{% for return_policy in return_policies %}
		<option value="{{ return_policy.returnPolicyId }}" {% if return_policy.returnPolicyId == return_policy_id %}selected{% endif %}>{{ return_policy.name }}</option>
		{% endfor %}
	  </select>
	  <label class="form-label select-label">{{ select_return_policy }}</label>
	</div>
	<div class="mt-3">
	  <select name="location_key" class="select">
		<option value="" selected disabled>{{ text_select }}</option>
		{% for location in locations %}
		<option value="{{ location.merchantLocationKey }}" {% if location.merchantLocationKey == location_key %}selected{% endif %}>{{ location.merchantLocationKey }}</option>
		{% endfor %}
	  </select>
	  <label class="form-label select-label">{{ select_location }}</label>
	</div>
	<div class="form-outline mt-3">
	  <input type="number" min="0" step="1" id="input-max_quantity_value" name="max_quantity_value" value="{{ max_quantity_value }}" class="form-control" />
	  <label class="form-label" for="input-max_quantity_value">{{ entry_max_quantity_value }}</label>
	</div>
	<div class="mt-2">
	  <p><small>{{ text_filter_price }}</small></p>
	  <div id="multi-ranges-price" data-mdb-tooltip="true"></div>
	  <input type="hidden" id="input-filter_max_price" name="filter_max_price" value="{{ filter_max_price }}" />
	  <input type="hidden" id="input-filter_min_price" name="filter_min_price" value="{{ filter_min_price }}" />
	</div>
	<div class="d-flex align-items-center mt-4">
	  <span class="me-2">+</span>
	  <div class="form-outline flex-fill">
		<input type="number" min="0" id="input-price_percent" name="price_percent" value="{{ price_percent }}" class="form-control" />
		<label class="form-label" for="input-price_percent">{{ entry_price_percent }}</label>
	  </div>
	  <span class="ms-2">%</span>
	</div>
	<div class="d-flex align-items-center mt-3">
	  <span class="me-2">+</span>
	  {% if currency.symbol_left %}<span class="me-2">{{ currency.symbol_left }}</span>{% endif %}
	  <div class="form-outline flex-fill">
		<input type="number" step="0.01" min="0" id="input-transport_price_fixed" name="transport_price_fixed" value="{{ transport_price_fixed }}" class="form-control" />
		<label class="form-label" for="input-transport_price_fixed">{{ entry_transport_price_fixed }}</label>
	  </div>
	  {% if currency.symbol_right %}<span class="ms-2">{{ currency.symbol_right }}</span>{% endif %}
	</div>
	<div class="row">
	  <div class="col-12 col-lg-2 mt-3">{{ text_price_by_weight }}</div>
	  <div id="container-transport_price_by_weight" class="col-12 col-lg-10">
		{% set i = 0 %}
		{% for price in transport_price_by_weight%}
		<div class="d-flex mt-3">
		  <div class="d-flex flex-fill align-items-center">
			<div class="form-outline flex-fill">
			  <input type="number" step="0.001" min="0" name="transport_price_by_weight[{{ i }}][weight_from]" value="{{ price.weight_from }}" class="form-control" />
			  <label class="form-label">{{ entry_from }}</label>
			</div>
			<span class="ms-2 me-2">{{ text_kg }}</span>
		  </div>
		  <div class="d-flex flex-fill align-items-center">
			<div class="form-outline flex-fill">
			  <input type="number" step="0.001" min="0" name="transport_price_by_weight[{{ i }}][weight_to]" value="{{ price.weight_to }}" class="form-control" />
			  <label class="form-label">{{ entry_to }}</label>
			</div>
			<span class="ms-2 me-2">{{ text_kg }}</span>
		  </div>
		  <div class="d-flex flex-fill align-items-center">
			{% if currency.symbol_left %}<span class="ms-2 me-2">{{ currency.symbol_left }}</span>{% endif %}
			<div class="form-outline flex-fill">
			  <input type="number" step="0.01" min="0" name="transport_price_by_weight[{{ i }}][price]" value="{{ price.price }}" class="form-control" />
			  <label class="form-label">{{ entry_price }}</label>
			</div>
			{% if currency.symbol_right %}<span class="ms-2 me-2">{{ currency.symbol_right }}</span>{% endif %}
		  </div>
		  <div class="d-flex align-items-center delete">
			<button type="button" class="btn btn-link text-danger"><i class="fas fa-times"></i></button>
		  </div>
		</div>
		{% set i = i + 1 %}
		{% endfor %}
		{% if transport_price_by_weight == 0 %}
		<div class="d-flex mt-3">
		  <div class="d-flex flex-fill align-items-center">
			<div class="form-outline flex-fill">
			  <input type="number" step="0.001" name="transport_price_by_weight[0][weight_from]" value="" class="form-control" />
			  <label class="form-label">{{ entry_from }}</label>
			</div>
			<span class="ms-2 me-2">{{ text_kg }}</span>
		  </div>
		  <div class="d-flex flex-fill align-items-center">
			<div class="form-outline flex-fill">
			  <input type="number" step="0.001" name="transport_price_by_weight[0][weight_to]" value="" class="form-control" />
			  <label class="form-label">{{ entry_to }}</label>
			</div>
			<span class="ms-2 me-2">{{ text_kg }}</span>
		  </div>
		  <div class="d-flex flex-fill align-items-center">
			{% if currency.symbol_left %}<span class="ms-2 me-2">{{ currency.symbol_left }}</span>{% endif %}
			<div class="form-outline flex-fill">
			  <input type="number" step="0.01" name="transport_price_by_weight[0][price]" value="" class="form-control" />
			  <label class="form-label">{{ entry_price }}</label>
			</div>
			{% if currency.symbol_right %}<span class="ms-2 me-2">{{ currency.symbol_right }}</span>{% endif %}
		  </div>
		  <div class="d-flex align-items-center delete">
			<button type="button" class="btn btn-link text-danger"><i class="fas fa-times"></i></button>
		  </div>
		</div>
		{% set i = 1 %}
		{% endif %}
		<div class="text-end mt-3"><button type="button" id="weight-add" class="btn btn-secondary"><i class="fa fa-plus me-2"></i>{{ button_add }}</button></div>
	  </div>
	</div>
	<div class="mt-3">
	  <textarea id="input-general_description" name="general_description">{{ general_description }}</textarea>
	</div>
	<button type="submit" class="btn btn-primary ps-5 pe-5 mt-3 mb-3"><i class="fa fa-save me-2"></i>{{ button_save }}</button>
  </form>
</div>
</main>
<script>
$(document).ready(function() {
 $('#input-general_description').summernote({
	height: 175,
	toolbar: false,
	disableDragAndDrop: true,
	tabDisable: true,
	placeholder: '{{ entry_general_description }}',
	callbacks: {
	  onPaste: function(e) {
		var bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text');
		e.preventDefault();
		setTimeout( function(){
		  document.execCommand( 'insertText', false, bufferText );
		}, 10 );
	  }
	}
  });
  
  const ranges = document.querySelector('#multi-ranges-price');
  const initRanges = new mdb.MultiRangeSlider(ranges, { tooltips: true, max: {{ max_price }}, min: 0, startValues: [{{ filter_min_price }}, {{ filter_max_price }}] });
  
  ranges.addEventListener('value.mdb.multiRangeSlider', (e) => {
	const [first, second] = e.values.rounded;
	$('#input-filter_min_price').val(first);
	$('#input-filter_max_price').val(second);
  });
});

let i = {{ i }};

$('#weight-add').click(function() {
  let html = '';
	html += '<div class="d-flex mt-3">';
	  html += '<div class="d-flex flex-fill align-items-center">';
		html += '<div class="form-outline flex-fill">';
		  html += '<input type="number" step="0.001" name="transport_price_by_weight['+i+'][weight_from]" value="" class="form-control" />';
		  html += '<label class="form-label">{{ entry_from }}</label>';
		html += '</div>';
		html += '<span class="ms-2 me-2">{{ text_kg }}</span>';
	  html += '</div>';
	  html += '<div class="d-flex flex-fill align-items-center">';
		html += '<div class="form-outline flex-fill">';
		  html += '<input type="number" step="0.001" name="transport_price_by_weight['+i+'][weight_to]" value="" class="form-control" />';
		  html += '<label class="form-label">{{ entry_to }}</label>';
		html += '</div>';
		html += '<span class="ms-2 me-2">{{ text_kg }}</span>';
	  html += '</div>';
	  html += '<div class="d-flex flex-fill align-items-center">';
		html += '{% if currency.symbol_left %}<span class="ms-2 me-2">{{ currency.symbol_left }}</span>{% endif %}';
		html += '<div class="form-outline flex-fill">';
			html += '<input type="number" step="0.01" name="transport_price_by_weight['+i+'][price]" value="" class="form-control" />';
			html += '<label class="form-label">{{ entry_price }}</label>';
		html += '</div>';
		html += '{% if currency.symbol_right %}<span class="ms-2 me-2">{{ currency.symbol_right }}</span>{% endif %}';
	  html += '</div>';
	  html += '<div class="d-flex align-items-center delete">';
		html += '<button type="button" class="btn btn-link text-danger"><i class="fas fa-times"></i></button>';
	  html += '</div>';
	html += '</div>';
	
  $('#weight-add').parent().before(html);
  i++;
  
  document.querySelectorAll('.form-outline').forEach((formOutline) => {
	new mdb.Input(formOutline).init();
  });
});

$('#container-transport_price_by_weight').delegate('.delete', 'click', function() {
  $(this).parent().remove();
});
</script>
{{ footer }} 
