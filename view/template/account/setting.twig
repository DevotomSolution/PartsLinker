{{ header }}{{ navigation }}
<main style="margin-top: 58px" class="pt-4">
<div class="container-fluid">
  <div class="text-end mb-3">
    <span class="btn btn-link text-dark" data-mdb-ripple-color="dark"><i class="fas fa-user me-2"></i>{{ text_account }}</span>
    <a href="{{ warehouse }}" class="btn btn-link " data-mdb-ripple-color="dark"><i class="fas fa-warehouse me-2"></i>{{ text_warehouse }}</a>
    <a href="{{ invoice }}" class="btn btn-link " data-mdb-ripple-color="dark"><i class="fas fa-file-lines me-2"></i>{{ text_invoice }}</a>
	<a href="{{ password }}" class="btn btn-link" data-mdb-ripple-color="dark"><i class="fas fa-key me-2"></i>{{ text_password }}</a>
  </div>
  {% if error_warning %}
  <div class="alert alert-dismissible fade show" role="alert" data-mdb-color="danger"><i class="fa fa-exclamation-circle me-2"></i>{{ error_warning }}<button type="button" class="btn-close" data-mdb-dismiss="alert" aria-label="Close"></button></div>
  {% endif %}
  {% if success %}
  <div class="alert alert-dismissible fade show" role="alert" data-mdb-color="success"><i class="fa fa-exclamation-circle me-2"></i>{{ success }}<button type="button" class="btn-close" data-mdb-dismiss="alert" aria-label="Close"></button></div>
  {% endif %}
	<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-setting" class="form-horizontal mb-3">
	  <div id="preview-logo" onclick="fileExplorer();" class="border rounded overflow-hidden d-inline-block" style="height: 120px;"><img src="{{ logo_preview }}" class="h-100" /></div>
	  <input type="file" class="d-none" accept="image/png,image/jpeg,image/jpg" id="selectfile" />
	  <input type="hidden" value="{{ logo }}" id="input-logo" name="logo"/>
	  <div class="form-outline mt-3">
		<input type="text" name="company" value="{{ company }}" class="form-control" />
		<label class="form-label">{{ entry_company }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="vat" value="{{ vat }}" class="form-control" />
		<label class="form-label">{{ entry_vat }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="website" value="{{ website }}" class="form-control" />
		<label class="form-label">{{ entry_website }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="phone" value="{{ phone }}" class="form-control" />
		<label class="form-label">{{ entry_phone }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="address_1" value="{{ address_1 }}" class="form-control" />
		<label class="form-label">{{ entry_address_1 }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="address_2" value="{{ address_2 }}" class="form-control" />
		<label class="form-label">{{ entry_address_2 }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="city" value="{{ city }}" class="form-control" />
		<label class="form-label">{{ entry_city }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="text" name="postcode" value="{{ postcode }}" class="form-control" />
		<label class="form-label">{{ entry_postcode }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" data-mdb-filter="true" name="country_id" id="input-country_id">
		  <option value="" selected>{{ text_select }}</option>
		  {% for country in countries %}
		  <option value="{{ country.country_id }}" {% if country.country_id == country_id %}selected{% endif %}>{{ country.name }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_country }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" data-mdb-filter="true" name="zone_id" id="input-zone_id">
		  <option value="" selected>{{ text_select }}</option>
		  {% for zone in zones %}
		  <option value="{{ zone.zone_id }}" {% if zone.zone_id == zone_id %}selected{% endif %}>{{ zone.name }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_zone }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="currency">
		  <option value="" selected disabled>{{ text_select }}</option>
		  {% for currency_data in currencies %}
		  <option value="{{ currency_data.code }}" {% if currency_data.code == currency %}selected{% endif %}>{{ currency_data.title }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_currency }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="language_id">
		  <option value="" selected disabled>{{ text_select }}</option>
		  {% for language in languages %}
		  <option value="{{ language.language_id }}" {% if language.language_id == language_id %}selected{% endif %}>{{ language.name }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_language }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="catalog">
			<option value="market" selected>{{ option_catalog_market }}</option>
			<option value="carparts" {% if catalog == 'carparts' %}selected{% endif %}>{{ option_catalog_carparts }}</option>
		</select>
		<label class="form-label select-label">{{ select_catalog }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="label">
		  {% for label_data in labels %}
		  <option value="{{ label_data.code }}" {% if label_data.code == label %}selected{% endif %}>{{ label_data.title }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_label }}</label>
	  </div>
	  <div class="form-outline mt-3">
		<input type="number" name="default_product_delivery" value="{{ default_product_delivery }}" max="99" class="form-control" />
		<label class="form-label">{{ entry_default_product_delivery }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="default_product_used">
		  <option value="0" selected>{{ option_quality_new }}</option>
		  <option value="1" {% if default_product_used == '1' %}selected{% endif %}>{{ option_quality_used }}</option>
		</select>
		<label class="form-label select-label">{{ select_default_product_used }}</label>
	  </div>
	  <div class="mt-3">
		<select class="select" name="default_brand" data-mdb-filter="true">
		  <option value="" selected>{{ text_select }}</option>
		  {% for brand in brands %}
		  <option value="{{ brand.name }}"{% if default_brand == brand.name %} selected{% endif %}>{{ brand.name }}</option>
		  {% endfor %}
		</select>
		<label class="form-label select-label">{{ select_default_brand }}</label>
	  </div>
	  <button type="submit" form="form-product" class="btn btn-primary submit mt-3" style="min-width: 150px;"><i class="fa fa-save me-2"></i>{{ button_save }}</button>
	</form>
</div>
</main>
<script>
$('.submit').click(function() {
  $('#form-setting').submit();
});

$('#input-country_id').change(function(event) {
  $.ajax({
	url: '{{ server }}index.php?route=account/setting.getZones&user_token={{ user_token }}&country_id=' + encodeURIComponent(event.target.value),
	dataType: 'json',
	success: function(json) {
	  $('#input-zone_id option[value!=""]').remove();
	  
	  $.each(json, function (i, item) {
		$('#input-zone_id').append($('<option>', { 
		  value: item.zone_id,
		  text : item.name
		}));
	  });
	}
  })
});

function fileExplorer() {
  document.getElementById('selectfile').click();
  document.getElementById('selectfile').onchange = function() {
	file = document.getElementById('selectfile').files[0];
	uploadImage(file);
  }
}

async function uploadImage(file) {
  if (file.type.match(/image.*/)) {
	imgFile = await imageResize(file, '{{ MAX_IMAGE_WIDTH }}', '{{ MAX_IMAGE_HEIGHT }}');
	
	let formData = new FormData();
	formData.append('logo', imgFile);

	$.ajax({
	  type: 'POST',
	  url: '{{ server }}index.php?route=account/setting.uploadImage&user_token={{ user_token }}',
	  contentType: false,
	  processData: false,
	  data: formData,
	  success:function(response) {
		if(response.error !== undefined) {
		  alert(response.error);
		  return;
		}
		
		$('#selectfile').val('');
		$('#preview-logo').html('<img src="' + response['preview'] + '" class="h-100" />');
		$('#input-logo').val(response['logo']);
	  }
	});
  }
}
</script>
{{ footer }} 